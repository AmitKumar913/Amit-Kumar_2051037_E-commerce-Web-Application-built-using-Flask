<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add a New Address</title>

    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #f2f2f2;
    margin: 0;
    padding: 0;
}

.container {
    background-color: white;
    max-width: 600px;
    margin: 50px auto;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h1 {
    font-size: 24px;
    margin-bottom: 20px;
}

.autofill-btn {
    display: block;
    width: 100%;
    padding: 10px;
    margin-bottom: 20px;
    background-color: #e1f5fe;
    border: 1px solid #b3e5fc;
    border-radius: 5px;
    color: #0277bd;
    font-size: 16px;
    cursor: pointer;
}

.autofill-btn:hover {
    background-color: #b3e5fc;
}

form {
    display: flex;
    flex-direction: column;
}

.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input, select, textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
}

input[type="checkbox"] {
    width: auto;
    margin-right: 10px;
}

.checkbox-group {
    display: flex;
    align-items: center;
}

small {
    display: block;
    margin-top: 5px;
    font-size: 12px;
    color: #666;
}

.submit-btn {
    padding: 10px;
    background-color:  #9E0059;
    border: none;
    border-radius: 5px;
    color: white;
    font-size: 16px;
    cursor: pointer;
    
}

.submit-btn:hover {
    background-color: #7A0045;
}
.back-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            background-color: #ccc;
            color: black;
            text-decoration: none;
            border-radius: 5px;
            font-size: 14px;
        }

    </style>

</head>
<body>
    <a href="javascript:history.back()" class="back-btn">&larr; Back</a>
    <div class="container">
        {% with messages=get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <div>
            <span>{{message}}</span>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
        <h1>Add a new address</h1>
        <!-- <button class="autofill-btn">Save time. Autofill your current location.</button> -->
        <button class="autofill-btn">Save time. Autofill your current location.</button>
        <form action="/add_address" method="post">
            <div class="form-group">
                <label for="country">Country/Region</label>
                <select id="country" name="country" required>
                    <option value="India">India</option>
                    <!-- Add other countries as needed -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="pincode">Pincode</label>
                <input type="text" id="pincode" name="pincode" pattern="[0-9]{6}" value="{{address['pincode']}}" required>
                
            </div>
            <div class="form-group">
                <label for="address1">Flat, House no., Building, Company, Apartment</label>
                <input type="text" id="address1" name="address1" value="{{address['address1']}}" required>
            </div>
            <div class="form-group">
                <label for="address2">Area, Street, Sector, Village</label>
                <input type="text" id="address2" name="address2"  value="{{address['address2']}}"required>
            </div>
            <div class="form-group">
                <label for="landmark">Landmark</label>
                <input type="text" id="landmark" name="landmark" value="{{address['landmark']}}">
            </div>
            <div class="form-group">
                <label for="city">Town/City</label>
                <input type="text" id="city" name="city" value="{{address['city']}}" required>
            </div>
            <div class="form-group">
                <label for="state">State</label>
                <input type="text" id="state" name="state" value="{{address['state']}}" required>
                <!-- <select id="state" name="state" required>
                    <option value="">Choose a state</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                    <option value="Chandigarh">Chandigarh</option>
                    <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                    <option value="Lakshadweep">Lakshadweep</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Puducherry">Puducherry</option>
                </select> -->
            </div>
            <button type="submit" class="submit-btn">Add address</button>
        </form>
    </div>
    <script>

document.getElementById('pincode').addEventListener('blur', function() {
    const pincode = this.value;
    if (pincode.length === 6) {
        console.log('Fetching data for pincode:', pincode);
        fetch(`/get_location/${pincode}`)
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Data received:', data);
                if (data.city || data.state) {
                    console.log("heloo")
                    document.getElementById('city').value = data.city;
                    document.getElementById('state').value = data.state;
                } else {
                    console.error('Error in data:', data.error);
                }
            })
            .catch(error => console.error('Error:', error));
    }
});

    </script>
    <script>
        // Get the autofill button
        const autofillBtn = document.querySelector('.autofill-btn');
        
        // Add click event listener to the autofill button
        autofillBtn.addEventListener('click', () => {
            // Check if geolocation is supported by the browser
            if (navigator.geolocation) {
                // Get the current position
                navigator.geolocation.getCurrentPosition(position => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    
                    // Call the geocoding API to get address details
                    fetch(`https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=71768945b3f34ae38069e22c8cfff11b`)
                        .then(response => response.json())
                        .then(data => {
                            // Check if the API returned valid data
                            if (data && data.results && data.results.length > 0) {
                                const addressComponents = data.results[0].components;
                                
                                // Fill the form fields with address details
                                document.getElementById('country').value = addressComponents.country || '';
                                document.getElementById('pincode').value = addressComponents.postcode || '';
                                document.getElementById('address1').value = addressComponents.house_number || '';
                                document.getElementById('address2').value = addressComponents.road || '';
                                document.getElementById('city').value = addressComponents.city || '';
                                document.getElementById('state').value = addressComponents.state || '';
                            } else {
                                console.error('Error: Unable to fetch address details.');
                            }
                        })
                        .catch(error => console.error('Error:', error));
                }, error => {
                    console.error('Error getting geolocation:', error);
                });
            } else {
                console.error('Geolocation is not supported by your browser.');
            }
        });
    </script>
</body>
</html>



